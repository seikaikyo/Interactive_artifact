# 鈺祥企業柳營再生戰情中心 - WISE-IOT Dashboard v3.1

基於研華 WISE-IOT 與 iEMS 概念發展的工廠智慧監控儀表板，**現已升級為企業級安全認證系統**，具備完整的帳號管理與 TOTP 雙重驗證功能。

## 🔐 安全認證系統

### ✨ 新增安全特性
- **🔑 亂數帳號系統**：管理員控制的授權帳號機制
- **🔒 固定密碼保護**：統一的系統存取密碼
- **📱 Authenticator 整合**：支援 Google/Microsoft/Authy 等主流 App
- **👥 帳號管理中心**：完整的使用者管理與監控功能
- **🛡️ 雙重驗證**：可選的 TOTP 時間型一次性密碼

### 🚀 認證流程
1. **管理員創建帳號** → 系統生成亂數帳號（如：`YS123456A`）
2. **提供給授權人員** → 配合固定密碼進行登入
3. **選擇性綁定** → 可綁定 Authenticator App 提升安全性
4. **完整追蹤** → 登入記錄、使用統計、綁定狀態管理

## 專案概述

本專案為再生濾網工廠戰情中心的可視化展示系統，整合 WMS 序號溯源追蹤與再生製程關鍵指標，提供即時的再生產線監控與分析功能。

## 再生製程流程

**濾網再生製令工單流程**: 到庫 → 除膠 → 烘烤 → 檢測 → 包裝

## 功能特色

### 再生製程監控
- **再生製程效率 (OEE)**: 濾網再生良率與製程通過率追蹤
- **再生產能對比**: 實際再生量與計畫目標的即時比較分析
- **製程瓶頸分析**: 除膠站、烘烤爐、檢測站利用率與等候時間統計
- **再生不良分析**: 除膠不完全、烘烤不均、污染殘留、破損裂紋等原因分佈

### 環境與設備監控
- **環境參數**: 溫度、濕度、AMC 濃度即時監控
- **SPC 烘烤爐製程**: Cpk值、烘烤溫度等關鍵製程參數統計管制
- **濾網檢測品質**: 檢測精度、誤判率趨勢追蹤
- **能源管理**: 尖峰離峰用電分析與單位再生品耗能

### 維運管理
- **再生製程告警**: 除膠站溶劑濃度、烘烤爐溫度、檢測站光源等異常告警與 MTTA/MTTR 統計
- **烘烤爐設備狀態**: 爐體溫度、烘烤時間、運行狀態等詳細參數監控

## 技術架構

### 前端技術
- **Vite**: 現代化前端建置工具
- **Chart.js**: 圖表視覺化函式庫
- **原生 JavaScript**: 輕量化實作，無複雜框架依賴
- **CSS Grid**: 響應式儀表板佈局

### 安全技術
- **TOTP (RFC 6238)**: 時間型一次性密碼標準
- **Web Crypto API**: 瀏覽器原生加密功能
- **SessionStorage**: 會話管理與自動清除
- **LocalStorage**: 帳號數據持久化存儲

### 部署平台
- **Vercel**: 雲端託管平台，支援自動部署
- **GitHub**: 程式碼版本控制與協作

## 快速開始

### 環境需求
- Node.js 16+
- npm 或 yarn

### 安裝與執行
```bash
# 安裝相依套件
npm install

# 啟動開發伺服器
npm run dev

# 建置正式版本
npm run build

# 預覽建置結果
npm run preview
```

### 🔐 首次使用安全設置

#### 線上版本（推薦）：
- **直接訪問**：https://wise-iot-factory-dashboard.vercel.app
- **自動帳號創建**：首次訪問會自動生成測試帳號
- **登入提示**：登入頁面會顯示可用的測試帳號
- **系統密碼**：請聯繫系統管理員取得（出於安全考慮不在此處顯示）

#### 本地開發環境：
1. **啟動開發伺服器**：`npm run dev`
2. **訪問系統**：http://localhost:5173
3. **自動帳號創建**：系統會自動創建測試帳號
4. **帳號管理**：可使用 `/create_account.html` 手動創建帳號

#### TOTP 雙重驗證設置：
1. **登入系統**：使用帳號密碼登入
2. **進入管理中心**：點擊右上角「帳號管理」
3. **綁定 Authenticator**：
   - 點擊「🔗 綁定 Authenticator」按鈕
   - 使用手機 App 掃描 QR Code 或手動輸入密鑰
   - 輸入 6 位數驗證碼完成綁定
4. **雙重驗證登入**：下次登入時需要帳號密碼 + TOTP 驗證碼

### 部署
專案已配置 Vercel 自動部署，推送至 main 分支即可觸發更新。

**🔧 更新域名別名：**
```bash
# 部署最新版本後，更新固定域名指向
npx vercel alias [最新部署URL] wise-iot-factory-dashboard.vercel.app
```

## 專案結構

```
├── index.html              # 主要 HTML 入口（SPA 架構）
├── create_account.html     # 帳號創建工具頁面
├── src/
│   ├── main.js             # SPA 路由與主要邏輯
│   ├── auth.js             # 認證系統與 TOTP 驗證
│   ├── accounts.js         # 帳號管理系統
│   ├── totp.js             # TOTP 加密與驗證實作
│   └── style.css           # 響應式樣式定義
├── public/
│   └── factory-image.png   # 靜態資源
├── vercel.json             # Vercel SPA 路由配置
└── package.json            # 專案相依性設定
```

## 開發原則遵循

1. **清爽專業設計**: 採用現代化 UI 設計，保持介面簡潔專業
2. **技術選用**: 使用輕量化技術棧，避免過度複雜的框架
3. **資源復用**: 基於既有 HTML 結構進行模組化重構
4. **版本控制**: 每個開發階段進行適當的 commit 與文件更新
5. **完整測試**: 確保所有功能模組正常運行後才進行部署

## 部署連結

- **正式環境**: https://wise-iot-factory-dashboard.vercel.app
- **帳號創建工具**: https://wise-iot-factory-dashboard.vercel.app/create_account.html
- **GitHub Repository**: https://github.com/seikaikyo/Interactive_artifact.git

## 🔒 安全功能詳述

### TOTP 實作細節
- **標準合規**: 遵循 RFC 6238 時間型一次性密碼標準
- **加密算法**: HMAC-SHA1 雜湊演算法
- **時間窗口**: 30秒更新週期，支援前後各1個窗口容錯
- **兼容性**: 支援 Google Authenticator、Microsoft Authenticator、Authy 等主流應用

### 資料安全
- **本地存儲**: 使用 localStorage 持久化帳號資料
- **會話管理**: SessionStorage 管理登入狀態，瀏覽器關閉自動清除
- **密鑰保護**: TOTP 密鑰經過 Base32 編碼儲存
- **防範措施**: 登入嘗試次數限制、自動鎖定機制

### 系統架構
- **SPA 設計**: 單頁應用架構，減少頁面跳轉
- **模組化**: 認證、帳號管理、TOTP 功能完全分離
- **響應式**: 支援桌面和行動裝置的一致體驗

## 維護說明

此系統為再生濾網工廠概念展示用途，數據為模擬生成。實際部署時需要整合真實的 WMS 追蹤系統、製程設備 IoT 數據源與 ERP API 介面。

## 數據來源整合

系統設計可同步資料至 DATALAKE，整合以下數據源：
- **AOI 資料**: 濾網檢測結果與品質數據
- **機聯網資料**: 除膠站、烘烤爐、檢測站設備狀態
- **ERP 資料**: 再生製令工單、物料追蹤、成本分析
- **其他資料**: 環境感測器、能源監控等

---

## 更新日誌

### v3.1 (2025-09-18)
- ✅ **TOTP 雙重驗證系統完整實作**
- ✅ **自動帳號創建機制**
- ✅ **SPA 架構重構**
- ✅ **響應式 UI 設計優化**
- ✅ **Vercel 域名別名管理**

### v3.0 (2025-09-17)
- ✅ **安全認證系統建置**
- ✅ **亂數帳號管理機制**
- ✅ **基礎 TOTP 框架**

---

**開發者**: 選我正解
**最後更新**: 2025-09-18
**系統版本**: v3.1 - TOTP Authentication System