<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç³»çµ±é‡ç½®å·¥å…·</title>
    <style>
        body {
            font-family: 'Microsoft JhengHei', Arial, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0;
            padding: 20px;
        }

        .container {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 40px;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
            width: 100%;
            max-width: 600px;
            text-align: center;
        }

        .btn {
            background: rgba(220, 53, 69, 0.3);
            border: 1px solid rgba(220, 53, 69, 0.5);
            color: #dc3545;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px;
            transition: all 0.3s ease;
        }

        .btn:hover {
            background: rgba(220, 53, 69, 0.5);
            transform: translateY(-1px);
        }

        .btn.success {
            background: rgba(40, 167, 69, 0.3);
            border-color: rgba(40, 167, 69, 0.5);
            color: #28a745;
        }

        .btn.success:hover {
            background: rgba(40, 167, 69, 0.5);
        }

        .log {
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            text-align: left;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            max-height: 300px;
            overflow-y: auto;
        }

        .warning {
            background: rgba(255, 193, 7, 0.1);
            border: 1px solid rgba(255, 193, 7, 0.3);
            color: #ffc107;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ ç³»çµ±é‡ç½®å·¥å…·</h1>
        <p>æ¸…é™¤æ‰€æœ‰å­˜å„²æ•¸æ“šä¸¦é‡æ–°å‰µå»ºç®¡ç†å“¡å¸³è™Ÿ</p>

        <div class="warning">
            <strong>âš ï¸ è­¦å‘Š</strong><br>
            æ­¤æ“ä½œå°‡å®Œå…¨æ¸…é™¤æ‰€æœ‰å¸³è™Ÿæ•¸æ“šã€èªè­‰æœƒè©±å’Œ TOTP ç¶å®šè¨˜éŒ„ã€‚<br>
            è«‹ç¢ºèªæ‚¨è¦é‡æ–°é–‹å§‹è¨­ç½®ç³»çµ±ã€‚
        </div>

        <div>
            <button class="btn" onclick="checkCurrentData()">æª¢æŸ¥ç•¶å‰æ•¸æ“š</button>
            <button class="btn" onclick="clearAllData()">æ¸…é™¤æ‰€æœ‰æ•¸æ“š</button>
            <button class="btn success" onclick="createFirstAdmin()">å‰µå»ºç¬¬ä¸€å€‹ç®¡ç†å“¡</button>
        </div>

        <div class="log" id="log"></div>

        <div style="margin-top: 20px;">
            <a href="/login.html" style="color: #00d4ff; text-decoration: none;">â†’ å‰å¾€ç™»å…¥é é¢</a> |
            <a href="/manage.html" style="color: #00d4ff; text-decoration: none;">â†’ å‰å¾€ç®¡ç†é é¢</a> |
            <a href="/" style="color: #00d4ff; text-decoration: none;">â†’ å‰å¾€ä¸»é </a>
        </div>
    </div>

    <script type="module">
        import AccountManager from './src/accounts.js';

        let logMessages = [];

        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${message}`;
            logMessages.push(logEntry);

            const logEl = document.getElementById('log');
            logEl.innerHTML = logMessages.join('\n');
            logEl.scrollTop = logEl.scrollHeight;

            console.log(logEntry);
        }

        window.checkCurrentData = () => {
            log('ğŸ” æª¢æŸ¥ç•¶å‰æ•¸æ“šç‹€æ…‹...');

            try {
                // æª¢æŸ¥ localStorage
                const localKeys = Object.keys(localStorage);
                log(`ğŸ“¦ localStorage é …ç›®æ•¸: ${localKeys.length}`);
                localKeys.forEach(key => {
                    log(`  - ${key}: ${localStorage.getItem(key)?.substring(0, 50)}...`);
                });

                // æª¢æŸ¥ sessionStorage
                const sessionKeys = Object.keys(sessionStorage);
                log(`ğŸ—‚ï¸ sessionStorage é …ç›®æ•¸: ${sessionKeys.length}`);
                sessionKeys.forEach(key => {
                    log(`  - ${key}: ${sessionStorage.getItem(key)?.substring(0, 50)}...`);
                });

                // æª¢æŸ¥å¸³è™Ÿç®¡ç†å™¨
                const accountManager = new AccountManager();
                accountManager.initialize();
                log(`ğŸ‘¥ ç³»çµ±å¸³è™Ÿæ•¸é‡: ${accountManager.accounts.length}`);

                if (accountManager.accounts.length > 0) {
                    accountManager.accounts.forEach((account, index) => {
                        log(`  ${index + 1}. ${account.username} (${account.isActive ? 'æ´»èº' : 'åœç”¨'}) - å‰µå»ºæ–¼ ${new Date(account.createdAt).toLocaleString()}`);
                    });
                }

            } catch (error) {
                log(`âŒ æª¢æŸ¥æ•¸æ“šæ™‚ç™¼ç”ŸéŒ¯èª¤: ${error.message}`);
            }
        };

        window.clearAllData = () => {
            if (!confirm('ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰æ•¸æ“šå—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸï¼')) {
                return;
            }

            log('ğŸ§¹ é–‹å§‹æ¸…é™¤æ‰€æœ‰æ•¸æ“š...');

            try {
                // æ¸…é™¤ localStorage
                const localCount = Object.keys(localStorage).length;
                localStorage.clear();
                log(`âœ… å·²æ¸…é™¤ ${localCount} å€‹ localStorage é …ç›®`);

                // æ¸…é™¤ sessionStorage
                const sessionCount = Object.keys(sessionStorage).length;
                sessionStorage.clear();
                log(`âœ… å·²æ¸…é™¤ ${sessionCount} å€‹ sessionStorage é …ç›®`);

                log('ğŸ‰ æ‰€æœ‰æ•¸æ“šå·²æ¸…é™¤å®Œæˆï¼');
                log('ğŸ’¡ ç¾åœ¨å¯ä»¥å‰µå»ºç¬¬ä¸€å€‹ç®¡ç†å“¡å¸³è™Ÿ');

            } catch (error) {
                log(`âŒ æ¸…é™¤æ•¸æ“šæ™‚ç™¼ç”ŸéŒ¯èª¤: ${error.message}`);
            }
        };

        window.createFirstAdmin = () => {
            log('ğŸš€ é–‹å§‹å‰µå»ºç¬¬ä¸€å€‹ç®¡ç†å“¡å¸³è™Ÿ...');

            try {
                const accountManager = new AccountManager();
                accountManager.initialize();

                if (accountManager.accounts.length > 0) {
                    log('âš ï¸ ç³»çµ±å·²æœ‰å¸³è™Ÿå­˜åœ¨ï¼Œè«‹å…ˆæ¸…é™¤æ•¸æ“š');
                    return;
                }

                const account = accountManager.createFirstAdminAccount();

                log(`âœ… ç®¡ç†å“¡å¸³è™Ÿå‰µå»ºæˆåŠŸï¼`);
                log(`ğŸ“‹ å¸³è™Ÿè³‡è¨Š:`);
                log(`   å¸³è™Ÿ: ${account.username}`);
                log(`   å¯†ç¢¼: ${accountManager.FIXED_PASSWORD}`);
                log(`   å‰µå»ºæ™‚é–“: ${new Date(account.createdAt).toLocaleString()}`);
                log('');
                log('ğŸ¯ è«‹è¨˜ä½é€™äº›è³‡è¨Šï¼Œç¾åœ¨å¯ä»¥å‰å¾€ç™»å…¥é é¢æ¸¬è©¦ï¼');

            } catch (error) {
                log(`âŒ å‰µå»ºç®¡ç†å“¡å¸³è™Ÿå¤±æ•—: ${error.message}`);
            }
        };

        // é é¢è¼‰å…¥æ™‚æª¢æŸ¥æ•¸æ“š
        window.addEventListener('load', () => {
            log('ğŸ”§ ç³»çµ±é‡ç½®å·¥å…·å·²è¼‰å…¥');
            checkCurrentData();
        });
    </script>
</body>
</html>